<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Collision Simulator with Calculations</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #2980b9;
            --red: #c0392b;
            --bg: #ecf0f1;
            --panel: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 20px;
            color: #333;
        }

        h1, h2 { color: var(--primary); text-align: center; margin: 10px 0; }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--panel);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* Input Section */
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .input-group { display: flex; flex-direction: column; }
        label { font-size: 0.85em; font-weight: bold; margin-bottom: 5px; }
        input, select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        
        .blue-txt { color: var(--accent); }
        .red-txt { color: var(--red); }

        .btn-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }

        button {
            padding: 10px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            transition: opacity 0.2s;
        }

        #btn-start { background-color: var(--accent); }
        #btn-reset { background-color: var(--red); }
        button:hover { opacity: 0.9; }

        /* Canvas */
        canvas {
            display: block;
            width: 100%;
            background: #fff;
            border: 2px solid #bdc3c7;
            border-radius: 4px;
            margin-bottom: 20px;
        }

        /* Data Tables */
        .data-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media(min-width: 768px) {
            .data-section { grid-template-columns: 1fr 1fr; }
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
            background: white;
            border: 1px solid #eee;
        }

        th { background-color: var(--primary); color: white; padding: 8px; }
        td { padding: 8px; text-align: center; border-bottom: 1px solid #eee; }
        tr:nth-child(even) { background-color: #f9f9f9; }

        /* Math Display */
        .math-box {
            grid-column: 1 / -1;
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            display: none; /* Hidden until collision */
        }
        
        .math-title {
            color: #f1c40f;
            font-weight: bold;
            border-bottom: 1px solid #7f8c8d;
            padding-bottom: 5px;
            margin-bottom: 10px;
            display: block;
        }

        .variable { color: #3498db; }
        .number { color: #e74c3c; }
    </style>
</head>
<body>

<div class="container">
    <h1>Collision Physics Engine</h1>

    <!-- Inputs -->
    <div class="controls">
        <div class="input-group">
            <label class="blue-txt">Mass 1 (kg)</label>
            <input type="number" id="m1" value="4.0" step="0.1" min="0.1">
        </div>
        <div class="input-group">
            <label class="blue-txt">Velocity 1 (m/s)</label>
            <input type="number" id="v1" value="5.0" step="0.1">
        </div>
        <div class="input-group">
            <label class="red-txt">Mass 2 (kg)</label>
            <input type="number" id="m2" value="2.0" step="0.1" min="0.1">
        </div>
        <div class="input-group">
            <label class="red-txt">Velocity 2 (m/s)</label>
            <input type="number" id="v2" value="-2.0" step="0.1">
        </div>
        <div class="input-group">
            <label>Collision Type</label>
            <select id="cType">
                <option value="elastic">Elastic (Bounce)</option>
                <option value="inelastic">Inelastic (Stick)</option>
            </select>
        </div>
    </div>

    <div class="btn-container">
        <button id="btn-start">Start Simulation</button>
        <button id="btn-reset">Reset</button>
    </div>

    <canvas id="simCanvas" width="800" height="200"></canvas>

    <!-- Calculation Log -->
    <div id="math-log" class="math-box">
        <span class="math-title">VELOCITY CALCULATION DETAILS</span>
        <div id="math-content">Waiting for collision...</div>
    </div>

    <div class="data-section">
        <!-- Before Table -->
        <div>
            <h2>Before Collision</h2>
            <table id="table-before">
                <thead>
                    <tr><th>Param</th><th>Trolley 1</th><th>Trolley 2</th><th>Total</th></tr>
                </thead>
                <tbody>
                    <tr><td>Mass (kg)</td><td id="b-m1">-</td><td id="b-m2">-</td><td>-</td></tr>
                    <tr><td>Vel (m/s)</td><td id="b-v1">-</td><td id="b-v2">-</td><td>-</td></tr>
                    <tr><td>Mom (kg·m/s)</td><td id="b-p1">-</td><td id="b-p2">-</td><td id="b-pt">-</td></tr>
                    <tr><td>KE (J)</td><td id="b-ke1">-</td><td id="b-ke2">-</td><td id="b-ket">-</td></tr>
                </tbody>
            </table>
        </div>

        <!-- After Table -->
        <div>
            <h2>After Collision</h2>
            <table id="table-after">
                <thead>
                    <tr><th>Param</th><th>Trolley 1</th><th>Trolley 2</th><th>Total</th></tr>
                </thead>
                <tbody>
                    <tr><td>Mass (kg)</td><td id="a-m1">-</td><td id="a-m2">-</td><td>-</td></tr>
                    <tr><td>Vel (m/s)</td><td id="a-v1">-</td><td id="a-v2">-</td><td>-</td></tr>
                    <tr><td>Mom (kg·m/s)</td><td id="a-p1">-</td><td id="a-p2">-</td><td id="a-pt">-</td></tr>
                    <tr><td>KE (J)</td><td id="a-ke1">-</td><td id="a-ke2">-</td><td id="a-ket">-</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // Canvas Setup
    const canvas = document.getElementById('simCanvas');
    const ctx = canvas.getContext('2d');

    // State Objects
    let animId;
    let running = false;
    let collided = false;

    // Physics Objects
    const t1 = { x: 50, m: 0, v: 0, color: '#3498db' };
    const t2 = { x: 650, m: 0, v: 0, color: '#c0392b' };
    
    // Store Initial State for Calculation Display
    let initialT1 = { m:0, v:0 };
    let initialT2 = { m:0, v:0 };

    function init() {
        // Stop any running loop
        cancelAnimationFrame(animId);
        running = false;
        collided = false;

        // Get Inputs
        t1.m = parseFloat(document.getElementById('m1').value);
        t1.v = parseFloat(document.getElementById('v1').value);
        t2.m = parseFloat(document.getElementById('m2').value);
        t2.v = parseFloat(document.getElementById('v2').value);

        // Reset positions
        t1.x = 100;
        t2.x = 600;

        // Save for Math Display later
        initialT1 = { ...t1 };
        initialT2 = { ...t2 };

        // UI Reset
        document.getElementById('math-log').style.display = 'none';
        clearTable('table-after');
        updateTable('table-before', t1, t2);

        draw();
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Floor
        ctx.beginPath();
        ctx.moveTo(0, 150);
        ctx.lineTo(canvas.width, 150);
        ctx.strokeStyle = '#7f8c8d';
        ctx.lineWidth = 3;
        ctx.stroke();

        drawTrolley(t1);
        drawTrolley(t2);
    }

    function drawTrolley(t) {
        // Size proportional to mass (clamped)
        let size = 40 + Math.min(t.m * 5, 40);
        
        ctx.fillStyle = t.color;
        ctx.fillRect(t.x, 150 - size, size, size);
        
        // Wheels
        ctx.fillStyle = '#2c3e50';
        ctx.beginPath();
        ctx.arc(t.x + 10, 150, 5, 0, Math.PI*2);
        ctx.arc(t.x + size - 10, 150, 5, 0, Math.PI*2);
        ctx.fill();

        // Label
        ctx.fillStyle = 'white';
        ctx.font = '12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(t.m + "kg", t.x + size/2, 150 - size/2 + 4);
    }

    function updateTable(tableId, obj1, obj2) {
        const pfx = tableId === 'table-before' ? 'b-' : 'a-';
        
        // Calc Momentum
        const p1 = obj1.m * obj1.v;
        const p2 = obj2.m * obj2.v;
        const pt = p1 + p2;

        // Calc KE
        const ke1 = 0.5 * obj1.m * obj1.v ** 2;
        const ke2 = 0.5 * obj2.m * obj2.v ** 2;
        const ket = ke1 + ke2;

        document.getElementById(pfx+'m1').innerText = obj1.m.toFixed(2);
        document.getElementById(pfx+'m2').innerText = obj2.m.toFixed(2);
        
        document.getElementById(pfx+'v1').innerText = obj1.v.toFixed(2);
        document.getElementById(pfx+'v2').innerText = obj2.v.toFixed(2);

        document.getElementById(pfx+'p1').innerText = p1.toFixed(2);
        document.getElementById(pfx+'p2').innerText = p2.toFixed(2);
        document.getElementById(pfx+'pt').innerText = pt.toFixed(2);

        document.getElementById(pfx+'ke1').innerText = ke1.toFixed(2);
        document.getElementById(pfx+'ke2').innerText = ke2.toFixed(2);
        document.getElementById(pfx+'ket').innerText = ket.toFixed(2);
    }

    function clearTable(tableId) {
        const pfx = tableId === 'table-before' ? 'b-' : 'a-';
        const ids = ['m1','m2','v1','v2','p1','p2','pt','ke1','ke2','ket'];
        ids.forEach(id => document.getElementById(pfx+id).innerText = '-');
    }

    function showCalculations(type, m1, v1, m2, v2, v1f, v2f) {
        const box = document.getElementById('math-log');
        const content = document.getElementById('math-content');
        box.style.display = 'block';

        let html = '';

        if(type === 'elastic') {
            html += `<strong>FORMULA (Elastic):</strong>\n`;
            html += `v1_final = [(m1 - m2) * v1 + 2 * m2 * v2] / (m1 + m2)\n`;
            html += `v2_final = [(2 * m1) * v1 + (m2 - m1) * v2] / (m1 + m2)\n\n`;
            
            html += `<strong>CALCULATION:</strong>\n`;
            html += `v1_f = [(${m1} - ${m2}) * ${v1} + 2 * ${m2} * ${v2}] / (${m1} + ${m2})\n`;
            html += `     = [(${m1-m2}) * ${v1} + ${2*m2} * ${v2}] / ${m1+m2}\n`;
            let num1 = (m1-m2)*v1 + (2*m2)*v2;
            html += `     = ${num1.toFixed(2)} / ${m1+m2}\n`;
            html += `     = <span class="blue-txt">${v1f.toFixed(2)} m/s</span>\n\n`;

            html += `v2_f = [2 * ${m1} * ${v1} + (${m2} - ${m1}) * ${v2}] / (${m1} + ${m2})\n`;
            html += `     = [${2*m1} * ${v1} + (${m2-m1}) * ${v2}] / ${m1+m2}\n`;
            let num2 = (2*m1)*v1 + (m2-m1)*v2;
            html += `     = ${num2.toFixed(2)} / ${m1+m2}\n`;
            html += `     = <span class="red-txt">${v2f.toFixed(2)} m/s</span>`;
        } else {
            html += `<strong>FORMULA (Perfectly Inelastic):</strong>\n`;
            html += `v_final = (Total Momentum) / (Total Mass)\n`;
            html += `v_final = (m1*v1 + m2*v2) / (m1 + m2)\n\n`;
            
            html += `<strong>CALCULATION:</strong>\n`;
            html += `v_f = (${m1} * ${v1} + ${m2} * ${v2}) / (${m1} + ${m2})\n`;
            let pTotal = (m1*v1) + (m2*v2);
            let mTotal = m1+m2;
            html += `    = (${(m1*v1).toFixed(2)} + ${(m2*v2).toFixed(2)}) / ${mTotal}\n`;
            html += `    = ${pTotal.toFixed(2)} / ${mTotal}\n`;
            html += `    = <span style="color:purple">${v1f.toFixed(2)} m/s</span> (Common Velocity)`;
        }

        content.innerHTML = html;
    }

    function loop() {
        if(!running) return;

        // Update Position
        t1.x += t1.v;
        t2.x += t2.v;

        // Collision Detection
        let size1 = 40 + Math.min(t1.m * 5, 40);
        // Simple AABB collision check
        if (!collided && (t1.x + size1 >= t2.x)) {
            collided = true;
            
            const type = document.getElementById('cType').value;
            const m1 = t1.m;
            const v1 = t1.v;
            const m2 = t2.m;
            const v2 = t2.v;

            let v1f, v2f;

            if (type === 'elastic') {
                v1f = ((m1 - m2) * v1 + 2 * m2 * v2) / (m1 + m2);
                v2f = ((2 * m1) * v1 + (m2 - m1) * v2) / (m1 + m2);
            } else {
                // Inelastic
                const vf = (m1 * v1 + m2 * v2) / (m1 + m2);
                v1f = vf;
                v2f = vf;
            }

            // Apply Physics
            t1.v = v1f;
            t2.v = v2f;

            // Visual correction so they don't overlap
            t2.x = t1.x + size1;

            // Display Results
            updateTable('table-after', t1, t2);
            showCalculations(type, initialT1.m, initialT1.v, initialT2.m, initialT2.v, v1f, v2f);
        }

        draw();
        
        // Stop if off screen
        if(t1.x > canvas.width || t2.x < 0 || t1.x < -100 || t2.x > canvas.width) {
            running = false;
        } else {
            animId = requestAnimationFrame(loop);
        }
    }

    // Event Listeners
    document.getElementById('btn-start').addEventListener('click', () => {
        if(!running) {
            if(collided) init(); // Auto reset if restarting after end
            running = true;
            loop();
        }
    });

    document.getElementById('btn-reset').addEventListener('click', init);

    // Initial Load
    init();

</script>
</body>
</html>