<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Photovoltaic Cell Learning Module</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        h1, h2 {
            color: #2c3e50;
            text-align: center;
        }

        /* --- Simulation Container --- */
        .sim-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 30px;
        }

        /* --- Legend Styles --- */
        .legend {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .legend-item {
            display: flex;
            align-items: center;
            font-size: 14px;
            font-weight: 600;
        }

        .icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
        }

        /* Matches JS Electron: #3498db */
        .icon-electron {
            background-color: #3498db;
            color: white;
            text-align: center;
            line-height: 20px; /* Center vertical */
            font-family: Arial, sans-serif;
            font-size: 14px;
        }

        /* Matches JS Hole: Stroke #e74c3c */
        .icon-hole {
            background-color: transparent;
            border: 2px solid #e74c3c;
            box-sizing: border-box; /* Ensures border is inside width/height */
        }

        /* Matches JS Photon: #f1c40f */
        .icon-photon {
            background-color: #f1c40f;
            box-shadow: 0 0 5px #f1c40f; /* Slight glow like the drawing */
        }

        canvas {
            border: 1px solid #ddd;
            background-color: #eef;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            max-width: 600px;
        }

        .controls {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        .slider-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* --- Theory Section --- */
        .theory-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            line-height: 1.6;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .theory-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 600px) {
            .theory-grid { grid-template-columns: 1fr; }
        }

        .step-box {
            background: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #3498db;
            border-radius: 4px;
        }

        /* --- Quiz Section --- */
        .quiz-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .question {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .options label {
            display: block;
            margin: 8px 0;
            cursor: pointer;
        }

        .feedback {
            margin-top: 10px;
            font-weight: bold;
            display: none;
        }

        .correct { color: #27ae60; }
        .incorrect { color: #c0392b; }

    </style>
</head>
<body>

    <h1>Solar Electricity: Photovoltaic Cells</h1>
    <p style="text-align: center;">Watch how light turns into electricity. Increase the sunlight intensity to generate current!</p>

    <!-- SIMULATION AREA -->
    <div class="sim-container">
        
        <!-- LEGEND ADDED HERE -->
        <div class="legend">
            <div class="legend-item">
                <span class="icon icon-photon"></span> Photon (Sunlight)
            </div>
            <div class="legend-item">
                <span class="icon icon-electron">-</span> Electron (Negative)
            </div>
            <div class="legend-item">
                <span class="icon icon-hole"></span> Hole (Positive)
            </div>
        </div>

        <canvas id="solarCanvas" width="600" height="400"></canvas>
        
        <div class="controls">
            <button onclick="toggleSim()">Pause / Play</button>
            <div class="slider-group">
                <label for="intensity">Sunlight Intensity:</label>
                <input type="range" id="intensity" min="0" max="10" value="3">
            </div>
        </div>
        <p><strong>Current: </strong> <span id="ammeter">0.0</span> mA</p>
    </div>

    <!-- THEORY SECTION -->
    <div class="theory-section">
        <h2>How it Works</h2>
        <div class="theory-grid">
            <div class="step-box">
                <strong>1. The Structure</strong>
                <p>A cell is a sandwich of two semiconductors: 
                <span style="color:orange; font-weight:bold;">n-type (top)</span> and 
                <span style="color:green; font-weight:bold;">p-type (bottom)</span>. 
                An electric field exists between them pointing from n to p.</p>
            </div>
            <div class="step-box">
                <strong>2. The Photon Strike</strong>
                <p>When sunlight (photons) hits the junction, it knocks an electron loose, creating an electron-hole pair. The <strong>Electric Field</strong> separates them immediately.</p>
            </div>
            <div class="step-box">
                <strong>3. The Separation</strong>
                <p><strong>Electrons (-)</strong> are forced to the n-side (top).<br>
                <strong>Holes (+)</strong> are forced to the p-side (bottom).<br>
                This creates a potential difference (Voltage).</p>
            </div>
            <div class="step-box">
                <strong>4. The Circuit</strong>
                <p>If connected to a wire, electrons flow out of the top, through the bulb (doing work), and return to the bottom to <strong>recombine</strong> with holes.</p>
            </div>
        </div>
    </div>

    <!-- QUIZ SECTION -->
    <div class="quiz-section">
        <h2>Check Your Understanding</h2>
        
        <div class="question" id="q1">
            <p><strong>1. Which direction does the internal electric field point inside the cell?</strong></p>
            <div class="options">
                <label><input type="radio" name="q1" value="wrong"> From p-type to n-type</label>
                <label><input type="radio" name="q1" value="correct"> From n-type to p-type</label>
                <label><input type="radio" name="q1" value="wrong"> It circulates in a loop</label>
            </div>
            <div class="feedback"></div>
        </div>

        <div class="question" id="q2">
            <p><strong>2. When a photon hits the junction, what is created?</strong></p>
            <div class="options">
                <label><input type="radio" name="q2" value="wrong"> Just heat</label>
                <label><input type="radio" name="q2" value="wrong"> A proton and a neutron</label>
                <label><input type="radio" name="q2" value="correct"> An electron and a hole</label>
            </div>
            <div class="feedback"></div>
        </div>

        <div class="question" id="q3">
            <p><strong>3. Where do the electrons move after being separated by the electric field?</strong></p>
            <div class="options">
                <label><input type="radio" name="q3" value="correct"> Towards the n-side (top)</label>
                <label><input type="radio" name="q3" value="wrong"> Towards the p-side (bottom)</label>
                <label><input type="radio" name="q3" value="wrong"> They stay in the center</label>
            </div>
            <div class="feedback"></div>
        </div>

        <div class="question" id="q4">
            <p><strong>4. What happens when the electron returns to the p-side after flowing through the circuit?</strong></p>
            <div class="options">
                <label><input type="radio" name="q4" value="wrong"> It bounces back to the n-side</label>
                <label><input type="radio" name="q4" value="correct"> It recombines with a hole</label>
                <label><input type="radio" name="q4" value="wrong"> It escapes the cell entirely</label>
            </div>
            <div class="feedback"></div>
        </div>

        <button onclick="checkAnswers()">Submit Answers</button>
    </div>

    <script>
        /**
         * SIMULATION LOGIC
         */
        const canvas = document.getElementById('solarCanvas');
        const ctx = canvas.getContext('2d');
        const ammeterEl = document.getElementById('ammeter');
        const intensitySlider = document.getElementById('intensity');

        let isRunning = true;
        let particles = []; // Stores photons, electrons, holes
        let electronsInCircuit = 0; // For calculating current

        // Dimensions
        const cellTop = 150;
        const cellHeight = 100;
        const junctionY = cellTop + 40; // The dividing line
        const cellWidth = 300;
        const cellX = (canvas.width - cellWidth) / 2;

        class Particle {
            constructor(type, x, y) {
                this.type = type; // 'photon', 'electron', 'hole'
                this.x = x;
                this.y = y;
                this.dead = false;
                this.pathProgress = 0; // For electrons on the wire
            }

            update() {
                if (this.type === 'photon') {
                    this.y += 3; // Fall down
                    // Hit Junction
                    if (this.y >= junctionY && this.x > cellX && this.x < cellX + cellWidth) {
                        this.dead = true;
                        spawnPair(this.x, this.y);
                    }
                    // Missed cell
                    if (this.y > canvas.height) this.dead = true;
                } 
                else if (this.type === 'hole') {
                    // Holes move down to the bottom of p-type and wait
                    if (this.y < cellTop + cellHeight - 10) {
                        this.y += 1; 
                    }
                } 
                else if (this.type === 'electron') {
                    this.moveAlongCircuit();
                }
            }

            moveAlongCircuit() {
                const speed = 4;
                // Waypoints for the electron path
                // 0: Junction -> 1: Top N-Layer -> 2: Wire Start -> 3: Bulb -> 4: Wire End -> 5: Bottom P-Layer
                
                // Phase 1: Move UP to N-layer surface
                if (this.pathProgress === 0) {
                    this.y -= 2;
                    if (this.y <= cellTop + 5) this.pathProgress = 1;
                }
                // Phase 2: Move LEFT to wire contact
                else if (this.pathProgress === 1) {
                    if (this.x > cellX - 50) this.x -= speed; // Move Left
                    else {
                        this.x = cellX - 50;
                        this.pathProgress = 2;
                    }
                }
                // Phase 3: Move UP wire
                else if (this.pathProgress === 2) {
                    if (this.y > 50) this.y -= speed;
                    else this.pathProgress = 3;
                }
                // Phase 4: Move RIGHT across top wire to bulb
                else if (this.pathProgress === 3) {
                    if (this.x < cellX + cellWidth + 50) this.x += speed;
                    else this.pathProgress = 4;
                }
                // Phase 5: Move DOWN through bulb
                else if (this.pathProgress === 4) {
                    if (this.y < cellTop + cellHeight + 50) this.y += speed;
                    else this.pathProgress = 5;
                }
                // Phase 6: Move LEFT back to cell bottom contact
                else if (this.pathProgress === 5) {
                    if (this.x > cellX + cellWidth / 2) this.x -= speed;
                    else {
                        // Recombination Logic
                        // Find a hole to recombine with
                        const holeIndex = particles.findIndex(p => p.type === 'hole' && !p.dead);
                        if (holeIndex !== -1) {
                            particles[holeIndex].dead = true; // Remove hole
                            this.dead = true; // Remove electron
                        } else {
                            // If no hole, wait here (simple logic)
                            this.dead = true; 
                        }
                    }
                }
            }

            draw() {
                ctx.beginPath();
                if (this.type === 'photon') {
                    // Wavy line or yellow dot
                    ctx.fillStyle = '#f1c40f';
                    ctx.arc(this.x, this.y, 4, 0, Math.PI * 2);
                    ctx.fill();
                    // Ray tail
                    ctx.strokeStyle = 'rgba(241, 196, 15, 0.5)';
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.x - 5, this.y - 15);
                    ctx.stroke();
                } else if (this.type === 'electron') {
                    ctx.fillStyle = '#3498db'; // Blue
                    ctx.arc(this.x, this.y, 5, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = 'white';
                    ctx.font = '10px Arial';
                    ctx.fillText('-', this.x - 2, this.y + 3);
                } else if (this.type === 'hole') {
                    ctx.strokeStyle = '#e74c3c'; // Red outline
                    ctx.lineWidth = 2;
                    ctx.arc(this.x, this.y, 5, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }
        }

        function spawnPair(x, y) {
            particles.push(new Particle('electron', x, y));
            particles.push(new Particle('hole', x, y));
        }

        function drawScene() {
            // Draw Wires
            ctx.strokeStyle = '#555';
            ctx.lineWidth = 4;
            ctx.beginPath();
            // Left wire (from n-type)
            ctx.moveTo(cellX, cellTop + 5); 
            ctx.lineTo(cellX - 50, cellTop + 5);
            ctx.lineTo(cellX - 50, 50);
            ctx.lineTo(cellX + cellWidth + 50, 50); // Top run
            
            // Right wire (down to load)
            ctx.lineTo(cellX + cellWidth + 50, cellTop + cellHeight + 50);
            // Bottom return
            ctx.lineTo(cellX + cellWidth/2, cellTop + cellHeight + 50);
            ctx.lineTo(cellX + cellWidth/2, cellTop + cellHeight);
            ctx.stroke();

            // Draw Bulb/Load
            ctx.fillStyle = electronsInCircuit > 0 ? '#ffeb3b' : '#ecf0f1'; // Glows if current
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            const bulbX = cellX + cellWidth + 50;
            const bulbY = (50 + cellTop + cellHeight + 50) / 2;
            
            ctx.beginPath();
            ctx.arc(bulbX, bulbY, 15, 0, Math.PI*2);
            ctx.fill();
            ctx.stroke();
            // Filament
            ctx.beginPath();
            ctx.moveTo(bulbX, bulbY-10);
            ctx.lineTo(bulbX-5, bulbY);
            ctx.lineTo(bulbX+5, bulbY);
            ctx.lineTo(bulbX, bulbY+10);
            ctx.stroke();

            // Draw Cell Layers
            // N-Type (Top)
            ctx.fillStyle = 'rgba(255, 230, 100, 0.8)'; // Yellowish
            ctx.fillRect(cellX, cellTop, cellWidth, 40);
            ctx.fillStyle = '#000';
            ctx.font = '14px Arial';
            ctx.fillText("n-type (-)", cellX + 10, cellTop + 25);

            // P-Type (Bottom)
            ctx.fillStyle = 'rgba(100, 200, 100, 0.8)'; // Greenish
            ctx.fillRect(cellX, junctionY, cellWidth, 60);
            ctx.fillStyle = '#000';
            ctx.fillText("p-type (+)", cellX + 10, junctionY + 45);

            // Junction Line
            ctx.beginPath();
            ctx.strokeStyle = 'rgba(0,0,0,0.2)';
            ctx.moveTo(cellX, junctionY);
            ctx.lineTo(cellX + cellWidth, junctionY);
            ctx.stroke();

            // Electric Field Arrow
            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.font = '12px Arial';
            ctx.fillText("E-Field", cellX + cellWidth + 10, junctionY);
            drawArrow(ctx, cellX + cellWidth + 25, junctionY - 15, cellX + cellWidth + 25, junctionY + 15);
        }

        function drawArrow(ctx, fromx, fromy, tox, toy) {
            var headlen = 10; 
            var dx = tox - fromx;
            var dy = toy - fromy;
            var angle = Math.atan2(dy, dx);
            ctx.beginPath();
            ctx.moveTo(fromx, fromy);
            ctx.lineTo(tox, toy);
            ctx.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));
            ctx.moveTo(tox, toy);
            ctx.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));
            ctx.strokeStyle = "#d35400";
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function loop() {
            if (!isRunning) return requestAnimationFrame(loop);

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            drawScene();

            // Spawn Photons based on intensity
            if (Math.random() < intensitySlider.value / 20) {
                const rX = cellX + 20 + Math.random() * (cellWidth - 40);
                particles.push(new Particle('photon', rX, 0));
            }

            // Update and Draw Particles
            // Count electrons in the "wire" phase for the ammeter
            let activeCurrent = 0;

            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.update();
                p.draw();
                
                if (p.type === 'electron' && p.pathProgress > 1 && p.pathProgress < 5) {
                    activeCurrent++;
                }

                if (p.dead) particles.splice(i, 1);
            }

            electronsInCircuit = activeCurrent;
            // Fake Ammeter reading
            ammeterEl.innerText = (electronsInCircuit * 0.5).toFixed(1);

            requestAnimationFrame(loop);
        }

        function toggleSim() {
            isRunning = !isRunning;
            if (isRunning) loop();
        }

        // Start
        loop();

        /**
         * QUIZ LOGIC
         */
        function checkAnswers() {
            const answers = {
                q1: "correct",
                q2: "correct",
                q3: "correct",
                q4: "correct"
            };

            for (let id in answers) {
                const options = document.getElementsByName(id);
                let selected = null;
                for (let opt of options) {
                    if (opt.checked) selected = opt.value;
                }

                const feedbackEl = document.querySelector(`#${id} .feedback`);
                feedbackEl.style.display = "block";
                
                if (selected === answers[id]) {
                    feedbackEl.textContent = "Correct!";
                    feedbackEl.className = "feedback correct";
                } else {
                    feedbackEl.textContent = "Incorrect. Try again!";
                    feedbackEl.className = "feedback incorrect";
                }
            }
        }
    </script>
</body>
</html>